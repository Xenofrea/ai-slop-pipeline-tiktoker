# Производительность

## Параллельная генерация

### До оптимизации (v1.3.1)
Последовательная генерация:
```
Видео 1: 2-5 мин
Видео 2: 2-5 мин
...
Видео 10: 2-5 мин
Озвучка: 30-60 сек

Итого: 25-60 минут
```

### После оптимизации (v1.4.3)
Параллельная генерация:
```
Генерация 3 вариантов текста: 10-20 сек (одновременно!)
Генерация промптов: 5-10 сек
Все 10 видео + озвучка: 2-5 мин (одновременно!)
  ↳ Каждое видео сохраняется сразу после генерации
Склейка: 30-60 сек

Итого: 3-6 минут
```

## Ускорение: 3-5x ⚡️

## Как это работает

### 1. Параллельная генерация и сохранение видео
```typescript
const videoPromises = prompts.map(async (prompt, i) => {
  const imageUrl = await generateImage(prompt);
  const video = await generateVideo(imageUrl);

  // Сразу сохраняем видео после генерации
  const videoPath = await downloadVideo(video.url, path);
  return videoPath;
});

const videoPaths = await Promise.all(videoPromises);
```

Все видео генерируются **одновременно** и **сразу сохраняются** после готовности.

### 2. Параллельная генерация аудио
```typescript
const [videos, audio] = await Promise.all([
  generateAllVideos(prompts),
  generateAudio(text)
]);
```

Озвучка генерируется **одновременно** с видео.

### 3. Параллельная генерация вариантов текста
```typescript
const variantPromises = [0, 1, 2].map(async (i) => {
  const response = await generateStoryVariant(description, i);
  return response;
});

const variants = await Promise.all(variantPromises);
```

Все 3 варианта текста генерируются **одновременно** (экономия 2/3 времени).

### 4. Таймеры для всех этапов
```
✅ Вариант 1 сгенерирован (232 символов) - 8.2s
✅ Вариант 2 сгенерирован (195 символов) - 8.5s
✅ Вариант 3 сгенерирован (218 символов) - 8.7s
⏱️  Общее время: 8.7s

✅ Сгенерировано промптов: 10 - 12.3s

✅ Завершено 3/10 видео - 145.2s
✅ Завершено 7/10 видео - 156.8s
✅ Все 10 видео сгенерированы и сохранены! - 182.5s

⏱️  Время генерации аудио: 15.2s
⏱️  Время склейки видео: 8.3s
⏱️  Время добавления аудио: 12.1s

⏱️  Общее время выполнения: 218.1s (3.6 мин)
```

Таймеры помогают:
- Видеть прогресс в реальном времени
- Находить узкие места
- Планировать время генерации

## Примеры времени генерации

| Длительность | Видео | Время (посл.) | Время (парал.) | Ускорение |
|--------------|-------|---------------|----------------|-----------|
| 6 сек        | 1     | 2-5 мин       | 2-5 мин        | 1x        |
| 12 сек       | 2     | 4-10 мин      | 2-5 мин        | 2x        |
| 30 сек       | 5     | 10-25 мин     | 3-6 мин        | 3-4x      |
| 45 сек       | 8     | 16-40 мин     | 4-7 мин        | 4-5x      | 
| 60 сек       | 10    | 20-50 мин     | 5-10 мин       | 4-5x      |

**Улучшение в v1.4.2:** Скачивание видео теперь происходит сразу после генерации каждого видео, а не отдельным этапом. Это экономит ~1-2 минуты и делает процесс более устойчивым к ошибкам.

## Требования

- Стабильное интернет-соединение
- Достаточно API квоты для параллельных запросов
- Node.js 18+ с поддержкой Promise.all

## Ограничения API

FAL.AI обрабатывает запросы асинхронно, поэтому параллельная генерация 
не создаёт дополнительной нагрузки на API.
